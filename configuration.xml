<root>
    <node name="test"
          groups="tests"
          template="template_test">

        <const name="check"><![CDATA[ps aux |grep {{ process_pattern }}]]></const>
        <const name="process_pattern"><![CDATA[{{ name }}]]></const>
        <const name="start"><![CDATA[start ${HOME}]]></const>
        <const name="maxtime"><![CDATA[10]]></const>
    </node>

    <template name="template_test">
        <trigger name="start">
            <BlkCmd>
                <Cmd level="1">
                    <stdin><![CDATA[{{ check }}]]></stdin>
                    <on_success>
                        <BlkCmd>
                            <Msg level="1">
                                <stdin><![CDATA[Already started]]></stdin>
                            </Msg>
                        </BlkCmd>
                    </on_success>
                    <on_failure>
                        <BlkCmd>
                            <Cmd level="1">
                                <stdin><![CDATA[{{ start }}]]></stdin>
                                <always>
                                    <BlkCmd maxtime="{{ maxtime }}" sleep="2" retry_end_on_rc="1">
                                        <Cmd level="1">
                                            <stdin><![CDATA[{{ check }}]]></stdin>
                                        </Cmd>
                                    </BlkCmd>
                                </always>
                            </Cmd>
                        </BlkCmd>
                    </on_failure>
                </Cmd>
            </BlkCmd>
        </trigger>
        <trigger name="stop" level="1">
            <BlkCmd>
                <Cmd level="1">
                    <stdin><![CDATA[echo "stop1"]]></stdin>
                </Cmd>
            </BlkCmd>
        </trigger>
    </template>
</root>